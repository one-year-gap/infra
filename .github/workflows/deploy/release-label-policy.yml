name: release-label-policy

on:
  workflow_call:
    inputs:
      labels-json:
        required: true
        type: string

permissions:
  contents: read
  pull-requests: read

jobs:
  validate-labels:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/github-script@v7
        with:
          script: |
            const labels = JSON.parse(`${{ inputs.labels-json }}` || "[]");
            if (!Array.isArray(labels)) {
              core.setFailed("labels-json must be a JSON array");
              return;
            }

            const releaseLabels = ["release:major", "release:minor", "release:patch"];
            const deployLabels = ["deploy:admin-web", "deploy:api-server", "deploy:customer-web"];

            const selectedRelease = releaseLabels.filter(l => labels.includes(l));
            const selectedDeploy = deployLabels.filter(l => labels.includes(l));

            if (selectedRelease.length !== 1) {
              core.setFailed(`release 라벨은 정확히 1개 필요: ${releaseLabels.join(", ")}`);
            }

            if (selectedDeploy.length < 1) {
              core.setFailed(`deploy 라벨은 1개 이상 필요: ${deployLabels.join(", ")}`);
            }
